# ERPNext v15.72.1 开发环境配置总结

## ✅ 环境配置完成

### 🎯 目标达成
- ✅ 成功配置 ERPNext v15.72.1 + Frappe v15.74.0
- ✅ 建立完整的Docker开发环境
- ✅ 配置本地代码挂载支持二次开发
- ✅ 集成个人Fork仓库进行开发
- ✅ 建立自动化启动和管理脚本

### 🔧 环境详情

**版本信息:**
- ERPNext: v15.72.1 (最新稳定版)
- Frappe Framework: v15.74.0 (最新稳定版)
- 数据库: MariaDB 10.6 with UTF8MB4
- 缓存: Redis 6.2-alpine
- 前端: Nginx 反向代理

**服务架构:**
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │    Backend      │    │   Database      │
│   (Nginx)       │────│   (Gunicorn)    │────│   (MariaDB)     │
│   Port: 8080    │    │   Port: 8000    │    │   Port: 3306    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │               ┌─────────────────┐    ┌─────────────────┐
         │               │   WebSocket     │    │     Redis       │
         └───────────────│   Port: 9000    │────│  Cache & Queue  │
                         └─────────────────┘    └─────────────────┘
                                 │
                    ┌─────────────────────────────────┐
                    │         Background Jobs          │
                    │  ┌─────────────┐ ┌─────────────┐ │
                    │  │ Scheduler   │ │   Queues    │ │
                    │  │             │ │ Short/Long  │ │
                    │  └─────────────┘ └─────────────┘ │
                    └─────────────────────────────────┘
```

### 📁 文件结构
```
D:\Desktop\Project\ERP\frappe_docker\
├── .env                      # 环境变量配置
├── apps.json                 # 应用仓库配置
├── compose.yaml              # Docker Compose 主文件
├── docker-compose.dev.yaml   # 开发环境覆盖配置
├── start-erpnext.ps1         # 环境启动脚本
├── stop-erpnext.ps1          # 环境停止脚本
├── dev-helper.ps1            # 开发助手工具
├── README-DEV.md             # 开发文档
├── apps/                     # 本地开发目录 (挂载)
│   ├── frappe/              # Frappe框架源码 (您的Fork)
│   └── erpnext/             # ERPNext源码 (您的Fork)
└── 项目总结.md               # 本文件
```

### 🚀 快速操作指南

#### 启动环境
```powershell
# 标准启动
.\start-erpnext.ps1

# 完全重建启动
.\start-erpnext.ps1 -Fresh

# 启动并显示日志
.\start-erpnext.ps1 -Logs
```

#### 访问系统
- **网页界面:** http://localhost:8080
- **用户名:** Administrator
- **密码:** admin

#### 开发操作
```powershell
# 查看服务状态
.\dev-helper.ps1 -Action status

# 查看特定服务日志
.\dev-helper.ps1 -Action logs -Service backend

# 进入容器Shell
.\dev-helper.ps1 -Action shell -Service backend

# 执行Bench命令
.\dev-helper.ps1 -Action bench -Command "migrate"
.\dev-helper.ps1 -Action bench -Command "clear-cache"
```

#### 停止环境
```powershell
# 标准停止 (保留数据)
.\stop-erpnext.ps1

# 完全清理停止
.\stop-erpnext.ps1 -Clean
```

### 🔄 开发工作流

1. **代码开发**
   - 在 `./apps/frappe/` 和 `./apps/erpnext/` 目录下进行开发
   - 代码修改实时生效，无需重启容器
   - 前端资源需要手动构建: `bench build`

2. **数据库操作**
   ```powershell
   # 应用迁移
   .\dev-helper.ps1 -Action bench -Command "migrate"
   
   # 清除缓存
   .\dev-helper.ps1 -Action bench -Command "clear-cache"
   ```

3. **自定义应用开发**
   ```bash
   # 在backend容器中
   bench new-app my_custom_app
   bench install-app my_custom_app
   ```

### 🛠️ 技术要点

#### Fork仓库集成
- **Frappe Fork:** https://github.com/NextAIGo/frappe.git
- **ERPNext Fork:** https://github.com/NextAIGo/erpnext.git
- 配置在 `apps.json` 中，支持特定分支开发

#### 本地挂载配置
```yaml
volumes:
  - ./apps:/home/frappe/frappe-bench/apps:cached
```
- 实现代码实时同步
- 支持IDE直接编辑
- 保持Git版本控制

#### 端口映射
- **Web服务:** 8080 → 8080 (Nginx)
- **数据库:** 3306 → 3306 (MariaDB)
- **内部服务:** 自动发现不暴露外部

### 📊 性能监控

当前资源使用情况：
```
Frontend (Nginx):    CPU: 0.00%  内存: ~10MB
Backend (Gunicorn):   CPU: 0.06%  内存: ~50MB  
Database (MariaDB):   CPU: 2.29%  内存: ~167MB
Redis Services:       CPU: 0.01%  内存: ~5-19MB
Queue Workers:        CPU: 0.06%  内存: ~50MB
WebSocket:           CPU: 0.00%   内存: ~53MB
```

### 🔐 安全配置

- 数据库密码: `123` (开发环境)
- 管理员账户: Administrator/admin
- 服务间通信: Docker内部网络
- 外部访问: 仅Web端口8080暴露

### 🚨 故障排除

#### 常见问题及解决方案

1. **端口占用**
   ```powershell
   netstat -ano | findstr :8080
   taskkill /PID <process_id> /F
   ```

2. **服务启动失败**
   ```powershell
   .\dev-helper.ps1 -Action logs -Service backend
   .\start-erpnext.ps1 -Fresh
   ```

3. **数据库连接问题**
   ```powershell
   docker-compose exec db mysql -u root -p123
   ```

4. **清除所有数据重新开始**
   ```powershell
   .\stop-erpnext.ps1 -Clean
   .\start-erpnext.ps1 -Fresh
   ```

### 🎯 下一步开发建议

1. **学习ERPNext架构**
   - 了解Frappe框架核心概念
   - 熟悉DocType、Controller、API结构

2. **设置IDE环境**
   - 配置VS Code Python开发环境
   - 安装ERPNext/Frappe插件

3. **版本控制**
   - 为你的自定义修改创建分支
   - 定期同步上游更新

4. **测试环境**
   - 考虑设置单独的测试实例
   - 实施自动化测试

### 📚 学习资源

- [ERPNext官方文档](https://docs.erpnext.com/)
- [Frappe框架文档](https://frappeframework.com/docs)
- [Docker Compose参考](https://docs.docker.com/compose/)

---

## 🎉 环境配置成功！

您的ERPNext v15.72.1开发环境已完全配置完成，可以开始进行二次开发工作。

**配置时间:** 2025年7月31日  
**环境版本:** ERPNext v15.72.1 + Frappe v15.74.0  
**配置类型:** Docker开发环境 + 本地代码挂载
